# =============================================================================
# SMSLY Microservices Shared Environment Configuration
# =============================================================================
# Master template for ALL microservices in the SMSLYCLOUD ecosystem
#
# ZERO-TRUST SECURITY DOCTRINE:
# 1. Each inter-service path uses a UNIQUE secret (not shared secrets)
# 2. Secrets must match EXACTLY between sender and receiver
# 3. Never use the same secret for different paths
# 4. Generate with: python -c "import secrets; print(secrets.token_hex(32))"
#
# Copy to .env in each microservice root or set in Railway Variables
# =============================================================================

# =============================================================================
# SHARED INFRASTRUCTURE
# =============================================================================

# PostgreSQL Database Connection
# For Railway: Use ${{Postgres.DATABASE_URL}}
DATABASE_URL=postgresql+asyncpg://smsly:smsly@localhost:5432/smsly

# Redis Connection (for caching, rate limiting, sessions)
# For Railway: Use ${{Redis.REDIS_URL}}
REDIS_URL=redis://localhost:6379/0

# RabbitMQ for Async Tasks (optional)
RABBITMQ_URL=amqp://guest:guest@rabbitmq:5672/

# MinIO/S3 Object Storage
S3_ENDPOINT_URL=http://minio:9000
S3_ACCESS_KEY=minio
S3_SECRET_KEY=minio123
S3_BUCKET_NAME=smsly-media

# =============================================================================
# ZERO-TRUST INTER-SERVICE SECRETS
# =============================================================================
# CRITICAL: Each secret is for a SPECIFIC sender â†’ receiver path
# The value in the SENDER must match the RECEIVER's corresponding variable

# --- Security Gateway Outbound Secrets ---
# Gateway is the first line of defense, authenticates to downstream services
GATEWAY_TO_PLATFORM_SECRET=     # Must match GATEWAY_SECRET in Platform API
GATEWAY_TO_BACKEND_SECRET=      # Must match GATEWAY_SECRET in Django Backend
GATEWAY_TO_IDENTITY_SECRET=     # Must match GATEWAY_SECRET in Identity Service
GATEWAY_TO_POLICY_SECRET=       # Must match GATEWAY_SECRET in Policy Service
GATEWAY_TO_RATELIMIT_SECRET=    # Must match GATEWAY_SECRET in Rate Limit Service
GATEWAY_TO_AUDIT_SECRET=        # Must match GATEWAY_SECRET in Audit Log Service

# --- Platform API Outbound Secrets ---
# Platform API orchestrates product microservices
PLATFORM_TO_BACKEND_SECRET=     # Must match PLATFORM_API_SECRET in Django Backend
PLATFORM_TO_IDENTITY_SECRET=    # Must match PLATFORM_API_SECRET in Identity Service
PLATFORM_TO_POLICY_SECRET=      # Must match PLATFORM_API_SECRET in Policy Service
PLATFORM_TO_RATELIMIT_SECRET=   # Must match PLATFORM_API_SECRET in Rate Limit Service
PLATFORM_TO_AUDIT_SECRET=       # Must match PLATFORM_API_SECRET in Audit Log Service

# --- Product Service Secrets ---
PLATFORM_TO_SMS_SECRET=         # Must match PLATFORM_API_SECRET in SMS Service
PLATFORM_TO_WHATSAPP_SECRET=    # Must match PLATFORM_API_SECRET in WhatsApp Service
PLATFORM_TO_VOICE_SECRET=       # Must match PLATFORM_API_SECRET in Voice Service
PLATFORM_TO_EMAIL_SECRET=       # Must match PLATFORM_API_SECRET in Email Service
PLATFORM_TO_MMS_SECRET=         # Must match PLATFORM_API_SECRET in MMS Service
PLATFORM_TO_RCS_SECRET=         # Must match PLATFORM_API_SECRET in RCS Service
PLATFORM_TO_VERIFICATION_SECRET=# Must match PLATFORM_API_SECRET in Verification Service
PLATFORM_TO_SILENTOTP_SECRET=   # Must match PLATFORM_API_SECRET in Silent OTP Service
PLATFORM_TO_CAMPAIGNS_SECRET=   # Must match PLATFORM_API_SECRET in Campaigns Service
PLATFORM_TO_CRM_SECRET=         # Must match PLATFORM_API_SECRET in CRM Service
PLATFORM_TO_LIVECHAT_SECRET=    # Must match PLATFORM_API_SECRET in Live Chat Service
PLATFORM_TO_SURVEY_SECRET=      # Must match PLATFORM_API_SECRET in Survey Service
PLATFORM_TO_MARKETING_SECRET=   # Must match PLATFORM_API_SECRET in Marketing Automation
PLATFORM_TO_AI_SECRET=          # Must match PLATFORM_API_SECRET in AI Service
PLATFORM_TO_ANALYTICS_SECRET=   # Must match PLATFORM_API_SECRET in Analytics Service
PLATFORM_TO_NUMBER_SECRET=      # Must match PLATFORM_API_SECRET in Number Registry
PLATFORM_TO_WEBHOOK_SECRET=     # Must match PLATFORM_API_SECRET in Webhook Service
PLATFORM_TO_VIDEO_SECRET=       # Must match PLATFORM_API_SECRET in Video Service

# --- Django Backend Outbound Secrets ---
BACKEND_TO_IDENTITY_SECRET=     # Must match BACKEND_SECRET in Identity Service
BACKEND_TO_AUDIT_SECRET=        # Must match BACKEND_SECRET in Audit Log Service

# --- Rate Limit Service Outbound Secrets ---
RATELIMIT_TO_POLICY_SECRET=     # Must match RATELIMIT_SECRET in Policy Service
RATELIMIT_TO_IDENTITY_SECRET=   # Must match RATELIMIT_SECRET in Identity Service
RATELIMIT_TO_AUDIT_SECRET=      # Must match RATELIMIT_SECRET in Audit Log Service

# --- Policy Service Outbound Secrets ---
POLICY_TO_AUDIT_SECRET=         # Must match POLICY_SECRET in Audit Log Service

# --- Identity Service Outbound Secrets ---
IDENTITY_TO_AUDIT_SECRET=       # Must match IDENTITY_SECRET in Audit Log Service

# =============================================================================
# REGULATORY INTELLIGENCE AI (Policy Service)
# =============================================================================
# For automated regulatory monitoring - runs daily at 2 AM UTC
AI_PROVIDER=openai              # Options: openai, anthropic, gemini
AUTO_APPLY_CHANGES=false        # Set true to auto-apply high-confidence updates
OPENAI_API_KEY=                 # For regulatory analysis via GPT-4
ANTHROPIC_API_KEY=              # For regulatory analysis via Claude
GEMINI_API_KEY=                 # For regulatory analysis via Gemini

# =============================================================================
# CIRCUIT BREAKER CONFIGURATION (smsly_core)
# =============================================================================
# Defaults for inter-service resilience
CIRCUIT_BREAKER_FAIL_THRESHOLD=5       # Failures before opening
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=3    # Successes to close from half-open
CIRCUIT_BREAKER_TIMEOUT_SECONDS=60     # Time in OPEN state before half-open
CIRCUIT_BREAKER_CALL_TIMEOUT_SECONDS=10 # Max time for a single call

# =============================================================================
# INTER-SERVICE METRICS (smsly_core)
# =============================================================================
METRICS_ENABLED=true
METRICS_PATH=/metrics
PROMETHEUS_MULTIPROC_DIR=/tmp/prometheus

# =============================================================================
# PASSWORD HASHING (smsly_core - Argon2id)
# =============================================================================
ARGON2_TIME_COST=3              # Number of iterations
ARGON2_MEMORY_COST=65536        # Memory in KB (64MB)
ARGON2_PARALLELISM=4            # Number of parallel threads
ARGON2_HASH_LENGTH=32           # Output hash length
ARGON2_SALT_LENGTH=16           # Salt length

# =============================================================================
# JWT CONFIGURATION (Identity Service)
# =============================================================================
JWT_ALGORITHM=EdDSA             # Ed25519 (preferred) or RS256
JWT_ISSUER=https://identity.smsly.cloud
JWT_AUDIENCE=https://api.smsly.cloud
JWT_ACCESS_TTL_SECONDS=900      # 15 minutes
JWT_REFRESH_TTL_SECONDS=604800  # 7 days

# =============================================================================
# SDK SECURITY (Security Gateway)
# =============================================================================
SDK_HEADER_KEY=X-SMSLY-SDK-KEY
SDK_HEADER_VALUE=smsly_sdk_v2_production_2026

# =============================================================================
# SERVICE DISCOVERY (Local Development)
# =============================================================================
SECURITY_GATEWAY_URL=http://localhost:8000
PLATFORM_API_URL=http://localhost:8001
POLICY_SERVICE_URL=http://localhost:8002
AUDIT_SERVICE_URL=http://localhost:8003
VERIFICATION_SERVICE_URL=http://localhost:8004
WHATSAPP_SERVICE_URL=http://localhost:8005
RATE_LIMIT_SERVICE_URL=http://localhost:8006
CAMPAIGNS_SERVICE_URL=http://localhost:8007
VOICE_SERVICE_URL=http://localhost:8008
IDENTITY_SERVICE_URL=http://localhost:8009
SMS_SERVICE_URL=http://localhost:8010
EMAIL_SERVICE_URL=http://localhost:8011
MMS_SERVICE_URL=http://localhost:8012
RCS_SERVICE_URL=http://localhost:8013
CRM_SERVICE_URL=http://localhost:8014
LIVECHAT_SERVICE_URL=http://localhost:8015
SURVEY_SERVICE_URL=http://localhost:8016
MARKETING_SERVICE_URL=http://localhost:8017
AI_SERVICE_URL=http://localhost:8018
ANALYTICS_SERVICE_URL=http://localhost:8019
SILENTOTP_SERVICE_URL=http://localhost:8020
BACKEND_URL=http://localhost:8080

# =============================================================================
# SERVICE DISCOVERY (Railway Production)
# =============================================================================
# These are set automatically by Railway private networking
# Format: http://<service-name>.railway.internal:PORT
# Uncomment for production:
# SMS_SERVICE_URL=http://smsly-sms.railway.internal:8000
# WHATSAPP_SERVICE_URL=http://smsly-whatsapp.railway.internal:8000
# etc.

# =============================================================================
# LOGGING & MONITORING
# =============================================================================
LOG_LEVEL=INFO                  # DEBUG, INFO, WARNING, ERROR
LOG_FORMAT=json                 # json or text
SENTRY_DSN=                     # Sentry error tracking

# =============================================================================
# CORS (Frontend Services)
# =============================================================================
CORS_ORIGINS=http://localhost:3000,http://localhost:3001,https://app.smsly.cloud

# =============================================================================
# FEATURE FLAGS
# =============================================================================
FF_CIRCUIT_BREAKER=true         # Enable circuit breaker for inter-service
FF_METRICS=true                 # Enable Prometheus metrics
FF_AUDIT_LOGGING=true           # Enable mandatory audit logging
FF_REGULATORY_INTELLIGENCE=true # Enable AI regulatory monitoring
